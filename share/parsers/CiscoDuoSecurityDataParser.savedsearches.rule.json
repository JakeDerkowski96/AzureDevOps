{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "workspace": {
            "type": "String"
        }
    },
    "resources": [
        {
            "properties": {
                "category": "Samples",
                "displayName": "CiscoDuoSecurity Data Parser",
                "query": "\nCiscoDuo_CL\r\n| extend EventVendor = 'Cisco'\r\n| extend EventProduct = 'Duo Security'\r\n| extend parse_json(description_s)\r\n| extend SrcDvcType=description_s['device'],\r\n    SrcIpAddr=iff(isnotempty(description_s), description_s['ip_address'], access_device_ip_s),\r\n    DstUserName=iff(isnotempty(username_s), username_s, user_name_s),\r\n    SrcUserName=object_s,\r\n    EventType=iff(isnotempty(eventtype_s), eventtype_s, event_type_s),\r\n    EventEndTime=unixtime_seconds_todatetime(tolong(timestamp_d)),\r\n    HttpUserAgentOriginal = description_s['user_agent']\r\n| project-rename DvcAction=action_s,\r\n    DvcHostname=host_s,\r\n    SrcGeoCountry=access_device_location_country_s,\r\n    SrcGeoCity=access_device_location_city_s,\r\n    SrcDvcOs=access_device_os_s,\r\n    DstGeoRegion=state_s,\r\n    EventResult=result_s,\r\n    EventResultDetails=reason_s,\r\n    AuthDeviceCountry=auth_device_location_country_s,\r\n    AuthFactor=factor_s,\r\n    AccessDvcIpAddr=access_device_ip_s,\r\n    AccessDvcBrowser=access_device_browser_s,\r\n    AccessDvcBrowserVersion=access_device_browser_version_s,\r\n    AccessDvcFlashVersion=access_device_flash_version_s,\r\n    AccessDvcEncryptionEnabled=access_device_is_encryption_enabled_b,\r\n    AccessDvcFirewallEnabled=access_device_is_firewall_enabled_b,\r\n    AccessDvcPasswordSet=access_device_is_password_set_b,\r\n    AccessDvcJavaVersion=access_device_java_version_s,\r\n    AccessDvcLocationState=access_device_location_state_s,\r\n    AccessDvcOsVersion=access_device_os_version_s,\r\n    AccessDvcSecurityAgents=access_device_security_agents_s,\r\n    Alias=alias_s,\r\n    User=email_s,\r\n    SrcAppId=application_key_s,\r\n    SrcAppName=application_name_s,\r\n    DvcIpAddr=auth_device_ip_s,\r\n    AuthDeviceCity=auth_device_location_city_s,\r\n    AuthDeviceState=auth_device_location_state_s,\r\n    SrcHostname=auth_device_name_s,\r\n    TrustedEndpointStatus=trusted_endpoint_status_s,\r\n    TransactionId=txid_g,\r\n    UserGroups=user_groups_s,\r\n    Explanations=explanations_s,\r\n    FromCommonNetblock=from_common_netblock_b,\r\n    FromNewUser=from_new_user_b,\r\n    SrcUserId=user_key_s,\r\n    SrcRiskLevel=low_risk_ip_b,\r\n    PriorityEvent=priority_event_b,\r\n    PriorityReasons=priority_reasons_s,\r\n    Sekey=sekey_s,\r\n    SurfacedAuthAccessDeviceBrowser=surfaced_auth_access_device_browser_s,\r\n    SurfacedAuthAccessDeviceBrowserVersion=surfaced_auth_access_device_browser_version_s,\r\n    SurfacedAuthAccessDeviceIp=surfaced_auth_access_device_ip_s,\r\n    SurfacedAuthAccessDeviceEncryptionEnabled=surfaced_auth_access_device_is_encryption_enabled_s,\r\n    SurfacedAuthAccessDeviceFirewallEnabled=surfaced_auth_access_device_is_firewall_enabled_s,\r\n    SurfacedAuthAccessDevicePasswordSet=surfaced_auth_access_device_is_password_set_s,\r\n    SurfacedAuthAccessDeviceLocationCity=surfaced_auth_access_device_location_city_s,\r\n    SurfacedAuthAccessDeviceLocationCountry=surfaced_auth_access_device_location_country_s,\r\n    SurfacedAuthAccessDeviceLocationState=surfaced_auth_access_device_location_state_s,\r\n    SurfacedAuthAccessDeviceOs=surfaced_auth_access_device_os_s,\r\n    SurfacedAuthAccessDeviceOsVersion_s=surfaced_auth_access_device_os_version_s,\r\n    SurfacedAuthAccessDeviceSecurityAgents=surfaced_auth_access_device_security_agents_s,\r\n    SurfacedAuthAlias=surfaced_auth_alias_s,\r\n    SurfacedAuthApplicationKey=surfaced_auth_application_key_s,\r\n    SurfacedAuthApplicationName=surfaced_auth_application_name_s,\r\n    SurfacedAuthEmail=surfaced_auth_email_s,\r\n    SurfacedAuthFactor=surfaced_auth_factor_s,\r\n    SurfacedAuthIsotimestamp=surfaced_auth_isotimestamp_t,\r\n    SurfacedAuthOodSoftware_s=surfaced_auth_ood_software_s,\r\n    SurfacedAuthReason=surfaced_auth_reason_s,\r\n    SurfacedAuthResult=surfaced_auth_result_s,\r\n    SurfacedAuthTimestamp=surfaced_auth_timestamp_d,\r\n    SurfacedAuthTransactionId=surfaced_auth_txid_s,\r\n    SurfacedAuthUserGroups=surfaced_auth_user_groups_s,\r\n    SurfacedAuthUserKey=surfaced_auth_user_key_s,\r\n    SurfacedAuthUserName=surfaced_auth_user_name_s,\r\n    SurfacedTimestamp=surfaced_timestamp_d,\r\n    EventUid=triage_event_uri_s,\r\n    TriagedAsInteresting=triaged_as_interesting_b,\r\n    Context=context_s,\r\n    Credits=credits_d,\r\n    IsoTimestamp=isotimestamp_t,\r\n    Phone=phone_s,\r\n    SrcDomainType=type_s\r\n    ",
                "functionAlias": "CiscoDuo",
                "version": 2
            },
            "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/ciscoduosecurity data parser')]",
            "type": "Microsoft.OperationalInsights/workspaces/providers/savedSearches",
            "apiVersion": "2020-08-01"
        }
    ]
}
